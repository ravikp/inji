# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

# Fastfile

ENV['FASTLANE_NODE_VERSION'] = '16.17.0'

plugins = [
  "fastlane-plugin-increment_version_code",
  "fastlane-plugin-sentry"
]

default_platform(:android)

  # before_all do
  #   sh("curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash")
  #   sh('export NVM_DIR="$HOME/.nvm" && [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" && export PATH="$NVM_DIR/versions/node/v16.17.0/bin:$PATH"')
  #   sh('node -v')
  #   sh("nvm install 16.17.0")
  #   sh("nvm use 16.17.0")
  #   ENV['FASTLANE_NODE_VERSION'] = '16.17.0'
  #   puts "Set node version here"
  # end
  desc "Install node and run the build"
  lane :build_inji do
  install_node
  increment_vc
  increment_vname
  build_android
  end

  lane :install_node do
    sh('curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -')
    sh('sudo apt-get install -y nodejs')
    node_version = sh('node --version')
    puts "Node.js version: #{node_version}"
  end
  

# platform :android do
#   desc "Execute Android"
#   lane :execute_android do
#   yes | sudo increment_vc
#   yes | sudo increment_vname
#   yes | sudo build_android
#   end

  desc "Increment version code"
  lane :increment_vc do
  increment_version_code(
       gradle_file_path: "./app/build.gradle",
  )
  end

  desc "Increment version name"
  lane :increment_vname do
  increment_version_name(
       gradle_file_path: "./app/build.gradle",
 )
  end

  desc "Build Android"
  lane :build_android do
  node_version = sh('node --version')
    puts "Node.js version: #{node_version}"
  gradle(
     task: "clean bundleNewlogicRelease",
  )
  end
  



